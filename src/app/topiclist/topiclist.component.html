<modal-addtopic></modal-addtopic>

<mat-toolbar color="primary">
	<div class="flex container">
		<h1>Topics</h1>
		<span class="flex-spacer"></span>
		<button mat-button title="{{'TOPICLIST_BUTTON_ADD' | translate}}" (click)="openAddTopicModal($event)"><fa-icon [icon]="faPlusSquare"></fa-icon> {{"TOPICLIST_BUTTON_ADD" | translate}}</button>
	</div>
</mat-toolbar>

<div class="container alert-box">
	<alert></alert>
</div>

<div class="container">
	<mat-card *ngFor="let topic of topicsList" [ngClass]="'step'+topic.stage" [routerLink]="['/topic', topic._id]">
		<mat-card-content>
			<mat-card-title>{{topic.name}}</mat-card-title>
			<p *ngIf="topic.stage == C.STAGE_REJECTED">{{topic.rejectedReason | translate}}</p>
			<p *ngIf="topic.stage == C.STAGE_SELECTION">{{topic.num_votes}} {{'TOPIC_LIST_LABEL_VOTES' | translate}}</p>
			<p *ngIf="topic.stage == C.STAGE_PROPOSAL">{{topic.num_proposals}} {{'TOPIC_LIST_LABEL_PROPOSALS' | translate}}</p>
			<div *ngIf="topic.stage == C.STAGE_CONSENSUS">
				<p>{{'TOPIC_LIST_LABEL_LEVEL' | translate}} {{topic.level | addone}}</p>
				<p>{{topic.numActiveGroups}} {{'TOPICLIST_LABEL_NUMGROUPS' | translate}}</p>
			</div>
			<p *ngIf="topic.stage == C.STAGE_PASSED">{{topic.valid_participants}} {{'TOPIC_LIST_LABEL_PARTICIPANTS' | translate}}</p>
		</mat-card-content>
		<mat-card-footer>
			<p *ngIf="topic.stage == C.STAGE_REJECTED">{{'TOPIC_STAGE_REJECTED' | translate}}: {{topic.stageRejectedStarted | date: 'y-MM-dd'}}</p>
			<p *ngIf="topic.stage == C.STAGE_SELECTION">
				<button mat-icon-button color="primary" (click)="toggleVote($event, topic._id)">
					<fa-icon [ngClass]="{'not-voted': !topic.voted}" [icon]="faHandPaper"></fa-icon>
				</button>
			</p>
			<p *ngIf="topic.stage == C.STAGE_PROPOSAL || topic.stage == C.STAGE_CONSENSUS"><countdown [time]="topic.nextDeadline"></countdown></p>
			<p *ngIf="topic.stage == C.STAGE_PASSED">{{'TOPIC_STAGE_FINISHED' | translate}}: {{topic.stagePassedStarted | date: 'y-MM-dd'}}</p>
		</mat-card-footer>
	</mat-card>
</div>
